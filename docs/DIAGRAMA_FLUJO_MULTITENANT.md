# ğŸ“Š Diagrama de Flujo Multi-Tenant

VisualizaciÃ³n simplificada del flujo completo de la aplicaciÃ³n multi-tenant.

## ğŸ¯ Flujo BÃ¡sico

```
Usuario â†’ Archivo Hosts â†’ Apache â†’ Laravel â†’ Base de Datos Tenant
```

## ğŸ“ Flujo Detallado con Ejemplo

### Escenario: Usuario accede a `http://empresa1.dokploy.movete.cloud/productos`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 1: NAVEGADOR                                                        â”‚
â”‚ Usuario escribe: http://empresa1.dokploy.movete.cloud/productos         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 2: SISTEMA OPERATIVO (Archivo hosts)                               â”‚
â”‚ Archivo: C:\Windows\System32\drivers\etc\hosts                          â”‚
â”‚                                                                          â”‚
â”‚ Busca: empresa1.dokploy.movete.cloud                                    â”‚
â”‚ Encuentra: 127.0.0.1    empresa1.dokploy.movete.cloud                   â”‚
â”‚                                                                          â”‚
â”‚ âœ… Traduce dominio â†’ 127.0.0.1 (localhost)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 3: APACHE (Puerto 80)                                              â”‚
â”‚ Archivo: C:\xampp\apache\conf\extra\httpd-vhosts.conf                   â”‚
â”‚                                                                          â”‚
â”‚ Recibe peticiÃ³n HTTP:                                                   â”‚
â”‚   GET /productos HTTP/1.1                                               â”‚
â”‚   Host: empresa1.dokploy.movete.cloud                                   â”‚
â”‚                                                                          â”‚
â”‚ Compara con Virtual Hosts:                                              â”‚
â”‚   âŒ ServerName: dokploy.movete.cloud                                   â”‚
â”‚   âœ… ServerAlias: *.dokploy.movete.cloud  â† COINCIDE                    â”‚
â”‚                                                                          â”‚
â”‚ Usa DocumentRoot: C:/proyecto/public                                    â”‚
â”‚ Ejecuta: C:/proyecto/public/index.php                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 4: LARAVEL INICIA                                                  â”‚
â”‚ Archivo: public/index.php                                               â”‚
â”‚                                                                          â”‚
â”‚ 1. Carga framework                                                      â”‚
â”‚ 2. Ejecuta middleware                                                   â”‚
â”‚ 3. Lee request: empresa1.dokploy.movete.cloud                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 5: MIDDLEWARE TENANCY                                              â”‚
â”‚ Paquete: stancl/tenancy                                                 â”‚
â”‚                                                                          â”‚
â”‚ $domain = request()->getHost();                                          â”‚
â”‚ // "empresa1.dokploy.movete.cloud"                                      â”‚
â”‚                                                                          â”‚
â”‚ Busca en Base de Datos Central (pos_central):                           â”‚
â”‚                                                                          â”‚
â”‚   SELECT * FROM domains                                                 â”‚
â”‚   WHERE domain = 'empresa1.dokploy.movete.cloud'                        â”‚
â”‚                                                                          â”‚
â”‚ Resultado:                                                              â”‚
â”‚   domain: empresa1.dokploy.movete.cloud                                 â”‚
â”‚   tenant_id: empresa1                                                   â”‚
â”‚                                                                          â”‚
â”‚ âœ… Tenant identificado: empresa1                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 6: CAMBIO DE BASE DE DATOS                                         â”‚
â”‚                                                                          â”‚
â”‚ Base de Datos Antes: pos_central (BD central)                           â”‚
â”‚                                                                          â”‚
â”‚ Laravel ejecuta:                                                        â”‚
â”‚   config([                                                              â”‚
â”‚     'database.connections.tenant.database' => 'tenantempresa1'          â”‚
â”‚   ]);                                                                   â”‚
â”‚   DB::setDefaultConnection('tenant');                                   â”‚
â”‚                                                                          â”‚
â”‚ Base de Datos Ahora: tenantempresa1 (BD del tenant)                     â”‚
â”‚                                                                          â”‚
â”‚ âœ… Todas las consultas usan la BD del tenant                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 7: PROCESAMIENTO DE RUTA                                           â”‚
â”‚ Archivo: routes/tenant.php                                              â”‚
â”‚                                                                          â”‚
â”‚ Ruta solicitada: GET /productos                                         â”‚
â”‚                                                                          â”‚
â”‚ Route::get('/productos', [ProductController::class, 'index']);          â”‚
â”‚                                                                          â”‚
â”‚ Ejecuta: ProductController@index                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 8: CONTROLADOR Y MODELO                                            â”‚
â”‚ Archivo: app/Http/Controllers/ProductController.php                     â”‚
â”‚                                                                          â”‚
â”‚ public function index()                                                 â”‚
â”‚ {                                                                       â”‚
â”‚     $products = Product::all();                                         â”‚
â”‚     // SELECT * FROM products                                           â”‚
â”‚     // (desde BD: tenantempresa1)                                       â”‚
â”‚                                                                          â”‚
â”‚     return view('products.index', [                                     â”‚
â”‚         'products' => $products                                         â”‚
â”‚     ]);                                                                 â”‚
â”‚ }                                                                       â”‚
â”‚                                                                          â”‚
â”‚ âœ… Obtiene productos de la BD del tenant empresa1                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 9: GENERACIÃ“N DE VISTA                                             â”‚
â”‚ Archivo: resources/views/products/index.blade.php                       â”‚
â”‚                                                                          â”‚
â”‚ Laravel genera HTML:                                                    â”‚
â”‚                                                                          â”‚
â”‚   <!DOCTYPE html>                                                       â”‚
â”‚   <html>                                                                â”‚
â”‚   <head>                                                                â”‚
â”‚     <link href="http://dokploy.movete.cloud/build/app.css">            â”‚
â”‚   </head>                                                               â”‚
â”‚   <body>                                                                â”‚
â”‚     <h1>Productos de Empresa 1</h1>                                     â”‚
â”‚     @foreach($products as $product)                                     â”‚
â”‚       <div>{{ $product->name }}</div>                                   â”‚
â”‚     @endforeach                                                         â”‚
â”‚   </body>                                                               â”‚
â”‚   </html>                                                               â”‚
â”‚                                                                          â”‚
â”‚ âš ï¸ Nota: Assets cargan desde dominio central                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 10: MIDDLEWARE DE ASSETS                                           â”‚
â”‚ Middleware: FixViteAssetsForTenants                                     â”‚
â”‚                                                                          â”‚
â”‚ Detecta que estamos en tenant (empresa1.dokploy.movete.cloud)           â”‚
â”‚                                                                          â”‚
â”‚ Reescribe URLs de assets:                                               â”‚
â”‚   src="/build/app.js"                                                   â”‚
â”‚   â†“                                                                     â”‚
â”‚   src="http://dokploy.movete.cloud/build/app.js"                        â”‚
â”‚                                                                          â”‚
â”‚ âœ… Todos los assets apuntan al dominio central                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 11: RESPUESTA HTTP                                                 â”‚
â”‚                                                                          â”‚
â”‚ Apache envÃ­a al navegador:                                              â”‚
â”‚                                                                          â”‚
â”‚   HTTP/1.1 200 OK                                                       â”‚
â”‚   Content-Type: text/html; charset=UTF-8                                â”‚
â”‚                                                                          â”‚
â”‚   <!DOCTYPE html>                                                       â”‚
â”‚   <html>...</html>                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 12: NAVEGADOR RENDERIZA                                            â”‚
â”‚                                                                          â”‚
â”‚ 1. Renderiza HTML                                                       â”‚
â”‚ 2. Carga CSS desde: http://dokploy.movete.cloud/build/app.css          â”‚
â”‚ 3. Carga JS desde: http://dokploy.movete.cloud/build/app.js            â”‚
â”‚ 4. Muestra productos de Empresa 1                                       â”‚
â”‚                                                                          â”‚
â”‚ âœ… PÃGINA COMPLETA RENDERIZADA                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Estructura de Bases de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BASE DE DATOS CENTRAL                        â”‚
â”‚                        pos_central                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TABLE: tenants                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ id     â”‚ name          â”‚ email               â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚empresa1â”‚ Empresa Uno   â”‚ admin@empresa1.com  â”‚              â”‚
â”‚  â”‚empresa2â”‚ Empresa Dos   â”‚ admin@empresa2.com  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚  TABLE: domains                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ id â”‚ domain                          â”‚ tenant_id â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ 1  â”‚ empresa1.dokploy.movete.cloud   â”‚ empresa1  â”‚          â”‚
â”‚  â”‚ 2  â”‚ empresa2.dokploy.movete.cloud   â”‚ empresa2  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BD TENANT: empresa1     â”‚   â”‚   BD TENANT: empresa2     â”‚
â”‚   tenantempresa1          â”‚   â”‚   tenantempresa2          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚   â”‚                           â”‚
â”‚ users                     â”‚   â”‚ users                     â”‚
â”‚ products                  â”‚   â”‚ products                  â”‚
â”‚ sales                     â”‚   â”‚ sales                     â”‚
â”‚ customers                 â”‚   â”‚ customers                 â”‚
â”‚ ...                       â”‚   â”‚ ...                       â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ (Datos de Empresa 1)      â”‚   â”‚ (Datos de Empresa 2)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ Flujo de Dominios

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   dokploy.movete.cloud       â”‚
                    â”‚   (Dominio Central)          â”‚
                    â”‚                              â”‚
                    â”‚   - Login                    â”‚
                    â”‚   - Registro de tenants      â”‚
                    â”‚   - Panel admin              â”‚
                    â”‚   - Sirve assets (CSS/JS)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                      â”‚                      â”‚
            â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ empresa1.            â”‚ â”‚ empresa2.            â”‚ â”‚ empresa3.            â”‚
â”‚ dokploy.movete.cloud â”‚ â”‚ dokploy.movete.cloud â”‚ â”‚ dokploy.movete.cloud â”‚
â”‚                      â”‚ â”‚                      â”‚ â”‚                      â”‚
â”‚ (Tenant 1)           â”‚ â”‚ (Tenant 2)           â”‚ â”‚ (Tenant 3)           â”‚
â”‚                      â”‚ â”‚                      â”‚ â”‚                      â”‚
â”‚ BD: tenantempresa1   â”‚ â”‚ BD: tenantempresa2   â”‚ â”‚ BD: tenantempresa3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ Puntos Clave

### 1. Un Solo CÃ³digo, MÃºltiples Datos
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MISMO CÃ“DIGO PHP                â”‚
â”‚     (C:/proyecto/public)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BD Tenant1 â”‚  â”‚  BD Tenant2 â”‚
â”‚  (Datos A)  â”‚  â”‚  (Datos B)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Assets Centralizados
```
empresa1.dokploy.movete.cloud/productos
                    â”‚
                    â”œâ”€ HTML desde: empresa1.dokploy.movete.cloud
                    â”œâ”€ CSS desde: dokploy.movete.cloud/build/app.css
                    â””â”€ JS desde: dokploy.movete.cloud/build/app.js
```

### 3. Archivo Hosts (Solo Desarrollo)
```
DESARROLLO:
  Archivo hosts â†’ 127.0.0.1

PRODUCCIÃ“N:
  DNS Real â†’ IP del Servidor
```

## ğŸ“ ComparaciÃ³n: Con vs Sin Multi-Tenancy

### âŒ SIN Multi-Tenancy (Tradicional)

```
Empresa 1:
  - Servidor dedicado
  - CÃ³digo separado
  - BD: empresa1_db
  - Dominio: app1.com

Empresa 2:
  - Servidor dedicado
  - CÃ³digo separado (duplicado)
  - BD: empresa2_db
  - Dominio: app2.com

Mantenimiento: âŒ Actualizar cada instancia por separado
Costo: ğŸ’°ğŸ’°ğŸ’° Alto (mÃºltiples servidores)
```

### âœ… CON Multi-Tenancy (Actual)

```
TODAS las Empresas:
  - UN solo servidor
  - UN solo cÃ³digo
  - BD separadas por tenant
  - Subdominios: *.dokploy.movete.cloud

Empresa 1 â†’ tenantempresa1
Empresa 2 â†’ tenantempresa2
Empresa 3 â†’ tenantempresa3

Mantenimiento: âœ… Actualizar UNA vez
Costo: ğŸ’° Bajo (un servidor)
```

## ğŸ¨ Variable de Entorno Centralizada

### Antes (Hardcoded) âŒ

```php
// En 15+ archivos diferentes:
$domain = 'dokploy.movete.cloud';
```

Cambiar dominio = Editar 15+ archivos ğŸ˜«

### Ahora (Centralizado) âœ…

```env
# .env
CENTRAL_DOMAIN=tudominio.com
```

```php
// En todos los archivos:
$domain = centralDomain();
```

Cambiar dominio = Editar 1 variable ğŸ‰

---

Para mÃ¡s detalles, consulta:
- [GuÃ­a Completa Apache/Hosts](COMO_FUNCIONA_APACHE_HOSTS.md)
- [Cambiar Dominio](CAMBIAR_DOMINIO.md)

